<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Healthy goal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link th:href="@{/css/style.css}" rel="stylesheet"/>
</head>
<body>
<!--/*@thymesVar id="user" type="java.util.List<be.intecbrussel.healthy_goal.model.User>"*/-->

<div class="container">
    <div class="row" id="title">
        <div class="col-xs-12">
            <h1>HEALTHY GOAL</h1>
        </div>
    </div>
    <div class="row" id="nav">
        <div class="col-md-10">
            Welcome, <span th:text="${user.name}">ID</span>
        </div>
        <div class="col-md-2">
            <form class="buttonForm" method="POST" action="/logout">
                <button type="submit" style="margin-top: 2rem;">Log Out</button>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12" id="data">
            <table>
                <thead>
                    <tr>
                        <th>
                            <img th:src="@{/img/height.svg}" alt="" width="72" height="72">
                        </th>
                        <th>
                            <img th:src="@{/img/weight.svg}" alt="" width="72" height="72">
                        </th>
                        <th>
                            <img th:src="@{/img/bmi.svg}" alt="" width="72" height="72">
                        </th>
                        <th>
                            Minimum weight to lose
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <span th:text="${user.height}">Height</span> m
                        </td>
                        <td>
                            <span th:text="${user.currentWeight}">Current weight</span> Kg
                        </td>
                        <td>
                            <span th:text="${user.currentBMI}">BMI</span>
                        </td>
                        <td>
                            <span th:text="${user.weightToLose}">Weight to lose</span> Kg
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="row">
        <h5>Set your current data</h5>
        <form method="POST"
              action="/setter" modelAttribute="user">
            <tr>
                <label path="height">height</label>
                <input type="text" th:field="*{user.height}"/>
                <label path="currentWeight">Current weight</label>
                <input type="text" th:field="*{user.currentWeight}"/>
                <input type="submit" value="Change"/>
            </tr>
        </form>
    </div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" th:inline="javascript">
        google.charts.load('current', {'packages': ['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Date', 'Your weight', 'Max healthy', 'Min healthy'],

                /*[# th:each="weight: ${user.weights}"]*/
                [ [[${#dates.format(new java.util.Date(weight.key))}]], [[${weight.value}]],
                    [[${user.healthyMaxWeight}]], [[${user.healthyMinWeight}]] ],
                /*[/]*/
            ]);

                var options = {
                title: 'Your progress:',
                hAxis: {title: 'Timeline', titleTextStyle: {color: '#333'}},
                vAxis: {
                    minValue: 40,
                    viewWindowMode: "explicit",
                    viewWindow: {
                        min: 40
                    },
                    ticks: [50, 60, 70, 80, 90, 100]
                }
            };

            var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>
    <div class="row" id="chart_div" style="width: 100%; height: 500px;" th:if="not ${user.weights.isEmpty()}"></div>

    <div class="row" id="advies">
        <span th:text="${T(be.intecbrussel.healthy_goal.model.Advies).getAdvies()}">value</span>
    </div>


    <div class="row" th:if="not ${user.weights.isEmpty()}">
        <table>
            <thead>
            <tr>
                <th>History</th>
                <th>delete</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="weight : ${user.weights}">
                <td>
                    <span th:text="${weightStat.index}">index</span>
                    - <span th:text="${#dates.format(new java.util.Date(weight.key))}"></span>
                    - <span th:text="${weight.value}">value</span>Kg
                    <br>
                </td>
                <td>
                    <form method="POST" action="/deleteValue">
                        <input type="hidden" name="key" th:value="${weight.key}"/>
                        <button type="submit">X</button>
                        <br>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
        <form class="buttonForm" method="POST" action="/clearData">
            <button type="submit" style="margin-top: 2rem;">Clear History</button>
        </form>
    </div>

    <div class="row">
        <a th:href="@{/deleteUser/{id}(id=${user.id})}">!!! Delete your account !!!</a>
    </div>

</div>
</body>
</html>